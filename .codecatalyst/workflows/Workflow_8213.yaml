Name: JavaJUnitNoMaven
SchemaVersion: "1.0"

Triggers:
  - Type: PUSH
    Branches:
      - main

Actions:
  BuildAndTest:
    Identifier: aws/build@v1
    Inputs:
      Sources:
        - WorkflowSource
    Compute:
      Type: EC2
    Configuration:
      Steps:
        - Run: |
            echo "üîß Step 1: Installing dependencies"
            sudo yum update -y
            sudo yum install -y java-17-openjdk-devel git wget unzip docker

            echo "üì¶ Installing kubectl"
            curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
            chmod +x kubectl
            sudo mv kubectl /usr/local/bin/

            echo "üìÅ Writing kubeconfig to file"
            echo "$KUBECONFIG_CONTENT" > kubeconfig.yaml
            export KUBECONFIG=$(pwd)/kubeconfig.yaml

            echo "üöÄ Testing cluster access"
            kubectl get nodes || { echo "‚ùå Kubernetes unreachable"; exit 1; }

            echo "‚úÖ K8s setup verified"
            env:
            KUBECONFIG_CONTENT: "{{ secrets.KUBECONFIG_CONTENT }}"
