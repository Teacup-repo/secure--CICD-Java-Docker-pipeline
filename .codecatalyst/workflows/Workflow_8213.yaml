Name: JavaJUnitNoMaven
SchemaVersion: "1.0"

Triggers:
  - Type: PUSH
    Branches:
      - main

Actions:
  BuildAndTest:
    Identifier: aws/build@v1
    Inputs:
      Sources:
        - WorkflowSource
    Compute:
      Type: EC2
    Configuration:
      Steps:
        - Run: |
            echo "🔧 Step 1: Installing dependencies"
            sudo yum update -y
            sudo yum install -y java-17-openjdk-devel git wget unzip

            echo "📁 Step 2: Cloning GitHub repo manually"
            cd /tmp
            git clone https://github.com/Teacup-repo/secure--CICD-Java-Docker-pipeline.git
            cd secure--CICD-Java-Docker-pipeline || { echo '❌ Repo folder not found'; exit 1; }

            echo "📦 Step 3: Checking folder structure"
            ls -l
            ls -l lib || echo "⚠️ lib folder not found"

            echo "🛠️ Step 4: Compiling Java"
            javac -cp "lib/*" TodoList.java todolist17Test.java || { echo "❌ Compilation failed"; exit 1; }

            echo "🚀 Step 5: Running tests"
            java -jar lib/junit-platform-console-standalone-1.10.0.jar -cp . --scan-classpath || { echo "❌ Tests failed"; exit 1; }

            echo "✅ Done!"
